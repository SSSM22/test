{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>{{hod}}</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://bootswatch.com/5/lux/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <style>
      .custom-box {
        width: 380px;
        box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5);
        padding: 20px;
        border-radius: 20px;
      }

      .custom-button-1 {
        margin-left: 150px;
      }

      .custom-button {
        margin: 20px;
      }

      .custom-button:hover {
        background: #fff;
        color: #000;
        transition: ease-in-out;
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.3);
      }
      .custom-button-1:hover {
        background: #fff;
        color: #000;
        transition: ease-in-out;
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.3);
      }

      .custom-padding {
        padding-top: 0px;
      }
    </style>
  </head>
  <body>
    <ul>
      <!-- {% for avg in dept_avg %} {{ avg|safe }} {% endfor %} 
        {% for avg in clg_avg %} {{ avg|safe }} {% endfor %} -->
    </ul>
    <div class="position-absolute top-50 start-50 translate-middle">
      <div style="display: flex; justify-content: space-between">
        <div class="container custom-box" style="margin: 50px">
          <div class="row">
            <h1 class="card-title text-center mb-4">{{hod}}</h1>
            <h1 class="card-title text-center mb-4">Logged In</h1>
            {% if messages %} {% for message in messages %}
            <h5 style="color: rgb(248, 34, 34)">{{message}}</h5>
            {% endfor %} {% endif %}

            <form action="/hod_view" method="get" class="p-4">
              <label class="form-label mt-2 custom-padding"
                ><b> Roll Number</b></label
              >
              <input
                type="text"
                class="form-control"
                id="Roll"
                name="Roll"
                placeholder="Enter Roll Number of Student"
              />

              <input
                class="btn btn-primary btn-block rounded-pill mt-4 custom-button-1"
                type="submit"
                value="Search"
              />
            </form>

            <form action="/hod_view" method="post">
              {% csrf_token %}
              <label for="year"><b>&nbsp;&nbsp;&nbsp;Choose year:</b></label>
              <select name="year" id="year" class="form-control">
                <option value="all">All</option>
                <option value="4">First Year</option>
                <option value="3">Second Year</option>
                <option value="2">Third Year</option>
                <option value="1">Fourth Year</option>
              </select>

              <br />
              <div class="footer">
                <input
                  class="btn btn-primary btn-block rounded-pill mt-2 custom-button"
                  type="submit"
                />
                <button
                  class="btn btn-primary btn-block rounded-pill mt-2 custom-button"
                  onclick="window.location.href='/logout'"
                  type="button"
                >
                  Logout
                </button>
              </div>
            </form>
          </div>
        </div>
        <div style="margin: 50px">
          <h3 class="text-center">Average Comparison</h3>
          <select name="department" id="department">
            <option value="college">college</option>
            <option value="cse">cse</option>
            <option value="it">it</option>
            <option value="eee">eee</option>
            <option value="ece">ece</option>
            <option value="csm">csm</option>
            <option value="aids">aids</option>
            <option value="aiml">aiml</option>
            <option value="mec">mec</option>
            <option value="civ">civ</option>
          </select>
          <canvas id="bargraph" width="400" height="400"></canvas>
          <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
                let ctx = document.getElementById('bargraph').getContext('2d');
                let selected = document.getElementById('department');
                let platforms = {{platforms|safe}}; // All platforms
                let dept = '{{dept|safe}}';
                let dept_avg = {{overall_avg|safe}}[dept];
                let clg_avg = {{overall_avg|safe}}[selected.value];

                let chartData = {
                    labels: platforms,
                    datasets: [{
                      label: ` ${dept}`,
                      data: dept_avg,
                      backgroundColor: 'rgba(255, 0, 0, 1)',
                      borderColor: 'rgba(255, 99, 132, 1)',
                      borderWidth: 1
                    },
                    {
                      label: `${selected.value}`,
                      data: clg_avg,
                      backgroundColor: 'rgba(87, 183, 235, 1) ',
                      borderColor: 'rgba(54, 162, 235, 1)',
                      borderWidth: 1
                    }]
                  };
                var chart = new Chart(ctx, {
                  type: 'bar',
                  data: chartData,
                  options: {
                    scales: {
                      yAxes: [{
                        ticks: {
                          beginAtZero: true
                        }
                      }]
                    }
                  }
                });


            selected.addEventListener('change', (event) => {
              const selectedValue = event.target.value;
                chartData.datasets[1].data = {{overall_avg|safe}}[selectedValue];
                chartData.datasets[1].label = selectedValue;
              // Re-render the chart using Chart.js update method
              chart.update();
            });
          </script>
        </div>
        <div style="margin: 50px">
          <table>
            <tr>
              <td>year</td>
              <td>codechef</td>
              <td>codeforces</td>
              <td>geeks</td>
              <td>hackerrank</td>
              <td>interviewbit</td>
              <td>leet</td>
              <td>spoj</td>
            </tr>

            {% for key, values in year_wise_profiles.items %}
            <tr>
              <td>{{key}}</td>

              {% for k, v in values.items %} {% for kf, vf in v.items %}
              <td>{{vf}}</td>
              {% endfor %} {% endfor %}
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
